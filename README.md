# Cinema

Cinema is an individual-based model that simulates the coevolution of movement strategies between predators and prey in a spatially explicit environment. 

https://github.com/christophnetz/Cinema_git

## Quick start

Execute one of the batch files in this folder to run the simulation with parameters specified in the corresponding config files. 
This should open a window called 'Cinema' that contains two panels, one with a landscape view (grass resource shown in green, 
herbivores in blue and predators in red), and the other a heatmap depicting the Neural network weights. Further details on how 
to pause, zoom in etc. are explained in the following paragraph on User Interface. 

If the program fails to run, first check whether the system requirements detailed below are met.


## Graphical User Interface

Users can follow the simulation through a graphical representation that includes three windows:
1) A depiction of the landscape that shows amounts of grass in green, herbivore densities in blue and predator densities in red.
2) A heatmap of the evolved weight values
3) A timeline plot 

The simulation can be paused or unpaused by pressing the space bar. When paused, the simulation can be advanced by 
single time steps using the right arrow key, or by whole generations using the Page Down key. To zoom into 
parts of the landscape, use Scroll, to move in the landscape use the arrow keys or hold left-click pressed and move the mouse.
The three color layers can be individually selected or switched off by right-click on the landscape. The color intensity 
of the three layers can be modulated by holding a combination of keys and scrolling (Ctrl+shift+scroll -> green, 
shift+scroll -> blue, Ctrl+scroll -> red). 
The heatmap of weights can be set to different color codes (right-click) and also be zoomed in using Scroll and moved up and down 
by holding left-click pressed. 
The timeline plot is closed by default and can be opened under View > Timeline. As before, the herbivore population 
is depicted in blue and the predator population in red. The x-axis goes from 0 to G and can be zoomed into by scrolling 
and moved around with left-click held pressed. Different y-axis parameters can be selected using right-click. The default
is average population fitness (=performance), the other options are average fitness of reproductive individuals, 
reproductive individuals, reproductive clades (number of unique artificial neural network lineages that produce offspring),
and complexity (proportion of non-zero weights in the population).


## System requirements

The program uses Windows C++ libraries and therefore depends on a Windows platform. 
Further,OpenGL 4.5 or higher is required.

## Versions

Here we have prepared a number of simulations with different parameter files (*.ini) 
that can be executed through the corresponding batch scripts. Of course, the parameters can also be altered 
independently by the user in the parameter files (see section on parameters for permissible values). 
Output can be generated by specifying an output directory ("outdir") in the parameter files.
The model code can be accessed on the master branch of our github repository.



## Parameters

### G
Parameter G sets the number of generations that the program is going to run. Each generation consists of T time steps.

### T
Parameter T sets the number of time steps per generation, and therefore also the number of movements an individual makes 
before reproduction occurs. This parameter can be of interest in the creation of ecological patterns: Low T (e.g. 2)
produces spatial patterns that are driven primarily by differential survival and offspring dispersal, while large T (e.g. 500)
create spatial patterns primarily driven by the movement decisions of individuals during their lifetimes. 
We used T = 100 as the default setting.

### Nmax
The parameter Nmax specifies the maximum allowable population size for both prey and predators, which has to be specified 
du to computational reasons. Beyond this value, the simulation halts. At Nmax = 100,000 and conversion rates for herbivores 
and predators that are in the range of the default parameters, Nmax is never reached. 

### Ninit
The population size at which herbivores and predators are initialized at the beginning of the simulation, =1000 by default.

### L
The parameter L sets the sensory and movement range diameter for predators and prey and can take the values of {3, 5, 7, 33}. 
A value of L = 3 describes a movement range equivalent to the Moore Neighborhood. Default parameters were prey.L = 3 and pred.L = 5. 
It is useful to set the predator movement range larger than the prey's, because this enables predators to catch up 
with prey and complicates the prey's task from simply moving away from predators, to being unpredictable to them. 

### ann
The parameter ann sets the artificial neural network to be used as a decision-making mechanism by the populations.
There are five types of predefined neural network topologies: DumbAnn, SimpleAnn_identitynf, SimpleAnn, SimpleAnnFB and
SmartAnn. DumbAnn implements random movements regardless of information inputs. SimpleAnn_identitynf has three weighing factors,
one per input, and an identity node function. This was the node function used in all our simulations shown in the publication.
SimpleAnn equally has three weighing factors, but applies a rectifier node function. The only difference to SimpleAnn_identitynf
is that individuals can move randomly, if all cells are evaluated negatively (-> 0). SimpleAnnFB is equivalent to SimpleAnn,
except that it contains two recursive weights, enabling individuals to keep track of past inputs. SmartAnn does not have recursive
weights, but implements an intermediate hidden layer of three nodes, resulting in a total of 16 weighing factors. Due to the 
intermediate layer, more complex input-output relations can be realized. 

### Sprout_radius
Sprout_radius sets the dispersal range, in which offspring are distributed. Sprout_radius of 1 corresponds again to 
the Moore Neighborhood. We used a Sprout_radius of 1 as default parameter. For global offspring dispersal,
Sprout_radius can be set to 256 (or landscape.dim/2).

### alpha
The alpha parameter gives the conversion rate, by which consumed food W is converted into offspring, by the formula
a/(1+b*N) * (W+g). It is 0.1 for herbivores and 0.6 for predators, by default.

### beta
The beta parameter determines the effect of density-dependence on number of offspring by the formula a/(1+b*N) * (W+g). 
However, we set beta to 0.0 by default, because density dependence arises automatically in our model through competition for resources.

### gamma
gamma determines a baseline food intake, that individuals receive. For herbivores, this value was 0.0, and for predators
0.6, meaning that predators are generalists that receive some food from outside the predator-prey interaction of our model.

### mutation_prob
The mutation_prob parameter sets the probability with which a network weight mutates during reproduction. 
Mutations are applied to offspring and the effect sizes are drawn from a Cauchy distribution. 
By default, mutation_prob =  0.001.

### mutation_step
If a weight mutates, the new weight value is given by the old value plus a mutation effect 
that is drawn from a Cauchy distribution with location 0 and scale equal to the mutationstep parameter.
By default, mutationstep = 0.001.

### mutation_knockout
per-individual chance of knockout mutations, where all movement weights are reset to one, and individuals thus move randomly.
We could not determine a significant effect of this parameter on our model, and therefore left it at 0.

### cmplx_penalty
Complexity penalty for weights != 0, to penalize the usage of information uses. Not used in our model and left at 0.

### noise_sigma
The information inputs and suitability scores, based on which individuals made movement decisions, were subjected to some perceptual noise that 
was implemented as follows: Inputs were multiplied by a random value drawn from a uniform distribution U(1.0 - noise_sigma, 1.0 + noise_sigma).
Noise drawn from the same distribution was also added to the suitability scores calculated by the individuals. While the noise at the perceptual level 
cannot be ameliorated by evolution, individuals can avoid or enhance noise at the level of suitability by increasing or decreasing 
the magnitude of their weights. By default, noise_sigma = 0.001. An interesting question of future research could be, 
how perceptual noise evolves during predator-prey coevolution and in the presence of an energetic trade-off.

### input layers
landscape layers that serve as input, where 0 = prey density, 1 = predator density, 2 = grass, and 3 = risk/predation chance.

### input_mask
The input_mask parameter can be used to turn off any of the three information inputs {prey, pred, grass}.
By default, however, all information inputs are turned on (input_mask = {1,1,1}). 

### max_grass_cover
Maxmimum value of grass cover, = 1 by default.

### grass_growth
The grass_growth parameter controls the amount by which grass increases in each time step, up until a maximum value of 1 
is reached. By default, grass growth = 0.01.

### grass_deplete
Amount of grass consumed by herbivores when visiting a cell, by default 1 (complete depletion).

### landscape.risk.image
The landscape risk image determines the predation risk across the cells of the landscape and the size of the landscape, 
which is 512 by default, with wrapped boundaries. The predation risk determines, how likely an encounter between a 
predator and a prey on the same cell will result in a successful predation event, during which the prey is 
killed and consumed by the predator.When risk.channel=0, the predation chance is 0.5, with risk.channel=1 
it's random noise between 0 and 1, and with risk.channel=2, predation chance increases towards the center of 
the landscape in a gaussian kernel.

## Graphical User Interface
Users can follow the simulation through a graphical representation that includes three windows:
1) A depiction of the landscape that shows amounts of grass in green, herbivore densities in blue and predator densities in red.
2) A heatmap of the evolved weight values
3) A timeline plot 

The simulation can be paused or unpaused by pressing the space bar. When paused, the simulation can be advanced by 
single time steps using the right arrow key, or by whole generations using the Page Down key. To zoom into 
parts of the landscape, use Scroll, to move in the landscape use the arrow keys or hold left-click pressed and move the mouse.
The three color layers can be individually selected or switched off by right-click on the landscape. The color intensity 
of the three layers can be modulated by holding a combination of keys and scrolling (Ctrl+shift+scroll -> green, 
shift+scroll -> blue, Ctrl+scroll -> red). 
The heatmap of weights can be set to different color codes (right-click) and also be zoomed in using Scroll and moved up and down 
by holding left-click pressed. 
The timeline plot is closed by default and can be opened under View > Timeline. As before, the herbivore population 
is depicted in blue and the predator population in red. The x-axis goes from 0 to G and can be zoomed into by scrolling 
and moved around with left-click held pressed. Different y-axis parameters can be selected using right-click. The default
is population size, the other options are average fitness, 
number of individuals with fitness > 0, reproductive clades (number of unique artificial neural network lineages that produce offspring),
and complexity (proportion of non-zero weights in the population).


## Authors
Christoph Netz, Hanno Hildenbrandt, Franz J. Weissing

## License
[MIT](https://choosealicense.com/licenses/mit/)
